<script>
    // Language support with department translations
    const translations = {
        en: {
            title: "Way Finder Navigation System",
            subtitle: "Find your way easily",
            searchPlaceholder: "🔍 Type department name (e.g., OPD, ICU, Lab)...",
            searchHint: "Type to filter departments",
            noResults: "No departments found. Try different keywords.",
            hitCounterTitle: "Wayfinder Usage Statistics",
            hitCounterLabel: "People helped find their way",
            departments: {
                pharmacy: { name: "Pharmacy", location: "Ground Floor", description: "Get your medicines here" },
                radiology: { name: "Radiology", location: "Basement Floor", description: "Xray & Scanning" },
                lab: { name: "Laboratory", location: "Ground Floor", description: "Blood tests & reports" },
                cardiology: { name: "Cardiology", location: "Basement Floor", description: "Heart care & OPD" },
                ortho: { name: "Orthopedics", location: "Ground Floor", description: "Bone & joint care" },
                ophthalmology: { name: "Ophthalmology", location: "Ground Floor", description: "Eye care OPD" },
                cafeteria: { name: "Cafeteria (West End)", location: "Ground Floor", description: "Food & refreshments" },
                pediatrics: { name: "Pediatrics OPD", location: "First Floor", description: "Child care & consultation" }
            }
        },
        hi: {
            title: "वे फाइंडर नेविगेशन सिस्टम",
            subtitle: "आसानी से अपना रास्ता खोजें",
            searchPlaceholder: "🔍 विभाग का नाम टाइप करें (जैसे, OPD, ICU, लैब)...",
            searchHint: "विभागों को फिल्टर करने के लिए टाइप करें",
            noResults: "कोई विभाग नहीं मिला। विभिन्न कीवर्ड आज़माएं।",
            hitCounterTitle: "वेफाइंडर उपयोग आंकड़े",
            hitCounterLabel: "लोगों को उनका रास्ता खोजने में मदद मिली",
            departments: {
                pharmacy: { name: "फार्मेसी", location: "ग्राउंड फ्लोर", description: "यहां से दवाएं प्राप्त करें" },
                radiology: { name: "रेडियोलॉजी", location: "बेसमेंट फ्लोर", description: "एक्सरे और स्कैनिंग" },
                lab: { name: "प्रयोगशाला", location: "ग्राउंड फ्लोर", description: "रक्त परीक्षण और रिपोर्ट" },
                cardiology: { name: "कार्डियोलॉजी", location: "बेसमेंट फ्लोर", description: "हृदय देखभाल और ओपीडी" },
                ortho: { name: "ऑर्थोपेडिक्स", location: "ग्राउंड फ्लोर", description: "हड्डी और जोड़ देखभाल" },
                ophthalmology: { name: "नेत्र विज्ञान", location: "ग्राउंड फ्लोर", description: "आंखों की देखभाल ओपीडी" },
                cafeteria: { name: "कैफेटेरिया (वेस्ट एंड)", location: "ग्राउंड फ्लोर", description: "भोजन और ताज़गी" },
                pediatrics: { name: "पीडियाट्रिक्स ओपीडी", location: "पहली मंजिल", description: "बच्चों की देखभाल और परामर्श" }
            }
        },
        ml: {
            title: "വേ ഫൈൻഡർ നാവിഗേഷൻ സിസ്റ്റം",
            subtitle: "എളുപ്പത്തിൽ നിങ്ങളുടെ വഴി കണ്ടെത്തുക",
            searchPlaceholder: "🔍 വകുപ്പ് പേര് ടൈപ്പ് ചെയ്യുക (ഉദാ: OPD, ICU, ലാബ്)...",
            searchHint: "വകുപ്പുകൾ ഫിൽട്ടർ ചെയ്യാൻ ടൈപ്പ് ചെയ്യുക",
            noResults: "വകുപ്പുകൾ കണ്ടെത്തിയില്ല. വ്യത്യസ്ത കീവേഡുകൾ പരീക്ഷിക്കുക.",
            hitCounterTitle: "വേഫൈൻഡർ ഉപയോഗ സ്ഥിതിവിവരക്കണക്കുകൾ",
            hitCounterLabel: "ആളുകൾക്ക് അവരുടെ വഴി കണ്ടെത്താൻ സഹായിക്കപ്പെട്ടു",
            departments: {
                pharmacy: { name: "ഫാർമസി", location: "ഗ്രൗണ്ട് ഫ്ലോർ", description: "നിങ്ങളുടെ മരുന്നുകൾ ഇവിടെ നിന്ന് ലഭിക്കും" },
                radiology: { name: "റേഡിയോളജി", location: "ബേസ്മെന്റ് ഫ്ലോർ", description: "എക്സ്-റേയും സ്കാനിങ്ങും" },
                lab: { name: "ലബോറട്ടറി", location: "ഗ്രൗണ്ട് ഫ്ലോർ", description: "രക്ത പരിശോധനകളും റിപ്പോർട്ടുകളും" },
                cardiology: { name: "കാർഡിയോളജി", location: "ബേസ്മെന്റ് ഫ്ലോർ", description: "ഹൃദയ പരിചരണം ഒപ്പം ഓപിഡി" },
                ortho: { name: "ഓർത്തോപീഡിക്സ്", location: "ഗ്രൗണ്ട് ഫ്ലോർ", description: "അസ്ഥി, സന്ധി പരിചരണം" },
                ophthalmology: { name: "ഓഫ്താൽമോളജി", location: "ഗ്രൗണ്ട് ഫ്ലോർ", description: "കണ്ണ് പരിചരണം ഓപിഡി" },
                cafeteria: { name: "കഫേറ്റീരിയ (വെസ്റ്റ് എൻഡ്)", location: "ഗ്രൗണ്ട് ഫ്ലോർ", description: "ഭക്ഷണവും ഉന്മേഷവും" },
                pediatrics: { name: "പീഡിയാട്രിക്സ് ഓപിഡി", location: "ഫസ്റ്റ് ഫ്ലോർ", description: "കുട്ടികളുടെ പരിചരണവും കൺസൾട്ടേഷനും" }
            }
        },
        ar: {
            title: "نظام الملاحة للعثور على الطريق",
            subtitle: "ابحث عن طريقك بسهولة",
            searchPlaceholder: "🔍 اكتب اسم القسم (مثل: OPD، ICU، المختبر)...",
            searchHint: "اكتب لتصفية الأقسام",
            noResults: "لم يتم العثور على أقسام. جرب كلمات رئيسية مختلفة.",
            hitCounterTitle: "إحصائيات استخدام Wayfinder",
            hitCounterLabel: "تم مساعدة الأشخاص في العثور على طريقهم",
            departments: {
                pharmacy: { name: "الصيدلية", location: "الطابق الأرضي", description: "احصل على أدويتك هنا" },
                radiology: { name: "الأشعة", location: "الطابق السفلي", description: "الأشعة السينية والمسح" },
                lab: { name: "المختبر", location: "الطابق الأرضي", description: "اختبارات الدم والتقارير" },
                cardiology: { name: "طب القلب", location: "الطابق السفلي", description: "رعاية القلب والعيادات الخارجية" },
                ortho: { name: "العظام", location: "الطابق الأرضي", description: "رعاية العظام والمفاصل" },
                ophthalmology: { name: "طب العيون", location: "الطابق الأرضي", description: "رعاية العيون والعيادات الخارجية" },
                cafeteria: { name: "الكافيتيريا (الطرف الغربي)", location: "الطابق الأرضي", description: "الطعام والمرطبات" },
                pediatrics: { name: "طب الأطفال العيادات الخارجية", location: "الطابق الأول", description: "رعاية الأطفال واستشارات" }
            }
        }
    };

    // Current language
    let currentLang = 'en';

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
        initializeLanguage();
        initializeSearch();
        initializeBackToTop();
        initializeHitCounter();
    });

    // Language Support
    function initializeLanguage() {
        const savedLanguage = localStorage.getItem('selectedLanguage') || 'en';
        const languageBtns = document.querySelectorAll('.language-btn');
        
        // Set active button
        languageBtns.forEach(btn => {
            if (btn.getAttribute('data-lang') === savedLanguage) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
            
            btn.addEventListener('click', function() {
                const lang = this.getAttribute('data-lang');
                changeLanguage(lang);
                
                languageBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Apply saved language
        changeLanguage(savedLanguage);
    }

    function changeLanguage(lang) {
        currentLang = lang;
        // Save language to localStorage
        localStorage.setItem('selectedLanguage', lang);
        const t = translations[lang];
        
        // Update interface text
        document.querySelector('.hospital-info h1').textContent = t.title;
        document.querySelector('.hospital-subtitle').textContent = t.subtitle;
        document.getElementById('searchInput').placeholder = t.searchPlaceholder;
        document.querySelector('.search-hint').textContent = t.searchHint;
        document.getElementById('noResults').textContent = t.noResults;
        
        // Update hit counter text
        document.querySelector('.hit-counter h3').textContent = t.hitCounterTitle;
        document.querySelector('.counter-label').textContent = t.hitCounterLabel;
        
        // Update department names and descriptions
        updateDepartmentTranslations(t.departments);
    }

    function updateDepartmentTranslations(departmentTranslations) {
        const departmentBoxes = document.querySelectorAll('.department-box');
        
        departmentBoxes.forEach(box => {
            const departmentName = box.getAttribute('data-name');
            const translation = departmentTranslations[departmentName];
            
            if (translation) {
                const titleElement = box.querySelector('h3');
                const locationElement = box.querySelector('.department-location');
                const descriptionElement = box.querySelector('p:last-child');
                
                if (titleElement) {
                    titleElement.textContent = translation.name;
                }
                if (locationElement) {
                    locationElement.textContent = translation.location;
                }
                if (descriptionElement) {
                    descriptionElement.textContent = translation.description;
                }
            }
        });
    }

    // FIXED Hit Counter Function with Cookie Fallback
    function initializeHitCounter() {
        // Cookie functions
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }
        
        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = `expires=${date.toUTCString()}`;
            document.cookie = `${name}=${value}; ${expires}; path=/; SameSite=Lax`;
        }
        
        let visitCount = getCookie('wayfinderVisitCount');
        
        // If no cookie, try localStorage
        if (visitCount === null || visitCount === 'null') {
            visitCount = localStorage.getItem('wayfinderVisitCount');
        }
        
        // If still no count, initialize to 0
        if (!visitCount || visitCount === 'null') {
            visitCount = 0;
        } else {
            visitCount = parseInt(visitCount);
        }
        
        visitCount++;
        
        // Save to both storage methods for redundancy
        setCookie('wayfinderVisitCount', visitCount, 365); // 1 year expiry
        localStorage.setItem('wayfinderVisitCount', visitCount);
        
        displayCounter(visitCount);
    }
    
    function displayCounter(count) {
        const counterElement = document.getElementById('visitCount');
        counterElement.textContent = count.toLocaleString();
        
        // Add a subtle animation
        counterElement.style.transform = 'scale(1.1)';
        setTimeout(() => {
            counterElement.style.transform = 'scale(1)';
        }, 300);
    }

    // Optional: Add reset function (you can call this from browser console if needed)
    function resetHitCounter() {
        if (confirm('Are you sure you want to reset the hit counter to 0?')) {
            localStorage.removeItem('wayfinderVisitCount');
            document.cookie = 'wayfinderVisitCount=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            document.getElementById('visitCount').textContent = '0';
            alert('Hit counter has been reset to 0');
        }
    }

    // Back to Top Button
    function initializeBackToTop() {
        const backToTopBtn = document.getElementById('backToTop');
        
        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTopBtn.style.display = 'flex';
            } else {
                backToTopBtn.style.display = 'none';
            }
        });
    }

    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Search Functionality
    function initializeSearch() {
        const searchInput = document.getElementById('searchInput');
        const noResults = document.getElementById('noResults');
        const departmentBoxes = document.querySelectorAll('.department-box');

        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            let visibleCount = 0;

            departmentBoxes.forEach(box => {
                const departmentName = box.getAttribute('data-name').toLowerCase();
                const keywords = box.getAttribute('data-keywords').toLowerCase();
                
                // Check if search term matches department name or any keyword
                const nameMatch = departmentName.includes(searchTerm);
                const keywordMatch = keywords.includes(searchTerm);
                
                if (searchTerm === '' || nameMatch || keywordMatch) {
                    box.classList.remove('hidden');
                    visibleCount++;
                } else {
                    box.classList.add('hidden');
                }
            });

            // Show/hide no results message
            if (visibleCount === 0 && searchTerm !== '') {
                noResults.style.display = 'block';
            } else {
                noResults.style.display = 'none';
            }
        });

        // Clear search when clicking on a department
        departmentBoxes.forEach(box => {
            box.addEventListener('click', function() {
                searchInput.value = '';
                departmentBoxes.forEach(b => b.classList.remove('hidden'));
                noResults.style.display = 'none';
                
                // Call showDirections with the department name
                const departmentName = this.getAttribute('data-name');
                showDirections(departmentName);
            });
        });
    }

    // Navigation function
    function showDirections(department) {
        if (department === 'pharmacy') {
            window.location.href = 'pharmacy.html';
        } else if (department === 'radiology') {
            window.location.href = 'radiology.html';
        } else if (department === 'cardiology') {
            window.location.href = 'cardiology.html';
        } else if (department === 'lab') {
            window.location.href = 'Lab.html';
        } else if (department === 'ortho') {
            window.location.href = 'ortho.html';
        } else if (department === 'ophthalmology') {
            window.location.href = 'ophthal.html';
        } else if (department === 'cafeteria') {
            window.location.href = 'westend.html';
        } else if (department === 'pediatrics') {
            window.location.href = 'pediatrics.html';
        } else {
            alert('Directions for ' + department + ' coming soon!');
        }
    }
</script>
